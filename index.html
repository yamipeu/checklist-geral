<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checklists de Protocolos</title>

<script defer>
let currentUser=null;

const data={
  "Mudança de Endereço":[
"Informar sobre custo/isenção, pedir para levar o equipamento e informar SLA",
"Filtrar o novo endereço",
"Verificar documentos",
"Verificar se já houve ME ou se pode ser isento",
"Abrir ME no ERP",
"Verificar se há atualização de plano (abrir atualização e enviar para o FAT, caso haja)",
"Gerar contrato (verificar informações em sistema)",
"Abrir a renovação (após o cliente assinar)",
"Encaminhar para a CS"
],
"Atualização de Plano":[
"Informar sobre o processo e benefícios",
"Verificar documentação e faturas",
"Abrir a atualização no ERP e preencher",
"Conferir informações em sistema",
"Enviar vídeo para o/a cliente",
"Gerar contrato",
"Abrir a renovação após a assinatura subir em sistema",
"Encerrar renovação"
]
};

window.onload=()=>{
 if(localStorage.user){
   currentUser=localStorage.user;
   showDashboard();
 }
}

function login(){
 const u=document.getElementById("username").value.trim();
 if(!u)return;
 currentUser=u;
 localStorage.user=u;
 if(!localStorage[u])localStorage[u]=JSON.stringify({count:0,photo:null});
 showDashboard();
}

function logout(){
 localStorage.removeItem("user");
 location.reload();
}

function showDashboard(){
 document.getElementById("login").style.display="none";
 document.getElementById("dash").style.display="block";
 document.getElementById("hello").innerText="Olá, "+currentUser;
 loadUser();
}

function loadUser(){
 const u=JSON.parse(localStorage[currentUser]);
 document.getElementById("count").innerText=u.count||0;
 if(u.photo)document.getElementById("avatar").src=u.photo;
}

function saveUser(obj){
 localStorage[currentUser]=JSON.stringify(obj);
}

function upload(e){
 const r=new FileReader();
 r.onload=()=>{
   let u=JSON.parse(localStorage[currentUser]);
   u.photo=r.result;
   saveUser(u);
   document.getElementById("avatar").src=r.result;
 };
 r.readAsDataURL(e.target.files[0]);
}

function openPhoto(){
 document.getElementById("modal").style.display="flex";
 document.getElementById("modalimg").src=document.getElementById("avatar").src;
}
function closePhoto(){
 document.getElementById("modal").style.display="none";
}

function openList(type){
 document.getElementById("lists").style.display="none";
 document.getElementById("check").style.display="block";
 document.getElementById("title").innerText=type;

 const area=document.getElementById("items");
 area.innerHTML="";

 data[type].forEach(t=>{
   area.innerHTML+=`
   <div class=item>
    <span>${t}</span>
    <input type=checkbox onchange=progress()>
   </div>`;
 });

 progress();
}

function back(){
 document.getElementById("check").style.display="none";
 document.getElementById("lists").style.display="block";
}

function progress(){
 const boxes=document.querySelectorAll(".item input");
 let done=[...boxes].filter(b=>b.checked).length;
 document.getElementById("bar").style.width=(done/boxes.length*100)+"%";
 if(done===boxes.length && boxes.length){
   let u=JSON.parse(localStorage[currentUser]);
   u.count++;
   saveUser(u);
   loadUser();
 }
}

</script>

<style>
body{
margin:0;font-family:Arial;background:#0b0b0b;color:white
}
header{
background:#111;padding:15px 30px;display:flex;justify-content:space-between;align-items:center
}
button{background:#e50914;border:none;color:white;padding:10px 18px;border-radius:6px;cursor:pointer}
.card{background:#181818;padding:30px;border-radius:12px;width:400px;margin:auto;margin-top:120px}
input{width:100%;padding:10px;border-radius:6px;border:none;margin-bottom:15px}
#dash{display:none;padding:30px}
.cards{display:flex;gap:20px;justify-content:center;margin-top:40px}
.opt{background:#181818;padding:40px;border-radius:12px;width:250px;text-align:center;cursor:pointer}
.top{display:flex;align-items:center;gap:15px}
.avatar{width:40px;height:40px;border-radius:50%;border:2px solid red;cursor:pointer}
.item{display:flex;justify-content:space-between;align-items:center;background:#151515;padding:15px;border-radius:8px;margin:10px 0}
.progress{height:6px;background:#333;border-radius:4px;overflow:hidden}
.bar{height:100%;background:#e50914;width:0%;transition:.3s}
#modal{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center}
#modal img{max-width:80%;border-radius:12px}
</style>
</head>

<body>

<header>
<b>Checklists de Protocolos</b>
<div class=top>
<span id=hello></span>
<input type=file hidden id=file onchange=upload(event)>
<img id=avatar class=avatar onclick=openPhoto()>
<button onclick=logout()>Logout</button>
</div>
</header>

<div id=login class=card>
<h2>Login</h2>
<input id=username placeholder="Digite seu username">
<button onclick=login()>Entrar</button>
</div>

<div id=dash>
<h2>Dashboard</h2>
<p>Atendimentos: <b id=count>0</b></p>
<button onclick=document.getElementById('file').click()>Upload Foto</button>

<div id=lists class=cards>
<div class=opt onclick="openList('Mudança de Endereço')">Mudança de Endereço</div>
<div class=opt onclick="openList('Atualização de Plano')">Atualização de Plano</div>
</div>

<div id=check style="display:none">
<button onclick=back()>Voltar</button>
<h2 id=title></h2>
<div class=progress><div id=bar class=bar></div></div>
<div id=items></div>
</div>

</div>

<div id=modal onclick=closePhoto()>
<img id=modalimg>
</div>

</body>
</html>
